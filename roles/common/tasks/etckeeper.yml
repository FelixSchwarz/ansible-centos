---

# etckeeper does not work with dnf out of the box because some output confuses
# ansible: https://bugzilla.redhat.com/show_bug.cgi?id=1762693
- name: enable copr repo for etckeeper (Fedora)
  copy:
    src: fschwarz-etckeeper-fedora.repo
    dest: /etc/yum.repos.d/
  when: is_fedora

- name: enable copr repo for etckeeper (EPEL)
  copy:
    src: fschwarz-etckeeper-epel-8.repo
    dest: /etc/yum.repos.d/
  when: is_centos8


- name: install etckeeper
  yum:
    name: etckeeper
    state: present

- name: check if etckeeper is initialized already
  stat: path=/etc/.etckeeper
  register: dot_etckeeper

- command: etckeeper init
  args:
    chdir: /etc
  when: dot_etckeeper.stat.exists == False


- name: check if etckeeper git repo has at least one commit
  stat: path=/etc/.git/refs/heads/master
  register: etckeeper_git

- command: etckeeper commit "initial commit"
  args:
    chdir: /etc
  when: etckeeper_git.stat.exists == False

